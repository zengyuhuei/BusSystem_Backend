<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>基隆公車調派系統-公車路線資訊</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
        <script src = "{{url_for('static', filename='js/websocket_open.js')}}"></script>
		<script src = "{{url_for('static', filename='js/bus_information.js')}}"></script>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3RdvutneSQCHgWDr4t7AAhKNx7jmMFz0&callback=initMap"></script>
        <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet">
				<style type="text/css">
					html, body { height: 70%; margin: 20; padding: 20; }
					#map { height: 100%; }
				</style>
    </head>
	
		<body onload="websocket_init()">
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3RdvutneSQCHgWDr4t7AAhKNx7jmMFz0"> //含金鑰
		</script>
		 <nav class="navbar navbar-expand-xl navbar-dark bg-dark" id="mainNav">
		  <div class="container">
			  <a class="navbar-brand" href="{{url_for('manager_index')}}">基隆公車調派系統</a>
			  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			  </button>
			
			<div class="navbar-collapse collapse" id="navbarText">
			  <ul class="nav navbar-nav">
				<li class="nav-item active"><a class = "nav-link" href="{{url_for('bus_information')}}">公車路線資訊</a></li>
				<li class="nav-item"><a class = "nav-link" href="{{url_for('add_busdriver')}}">新增司機</a></li>
				<li class="nav-item"><a class = "nav-link" href="{{url_for('timely_bus_information')}}"> 即時公車資訊</a></li>
				<li class="nav-item"><a class = "nav-link" href="{{url_for('Human_dispatch')}}"> 人力調派</a></li>
				<li class="nav-item"><a class = "nav-link" href="{{url_for('historical_record')}}"> 歷史紀錄</a></li>
				<li class="nav-item"><a class = "nav-link" href="{{url_for('Emergency_reception')}}"> 突發狀況接收</a></li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					  修改路線/班次
					</a>
					<div class="dropdown-menu" aria-labelledby="navbarDropdown">
					  <a class="dropdown-item" href="{{url_for('add_or_revise_shift')}}">新增/修改班次</a>
					  <a class="dropdown-item" href="{{url_for('revise_path')}}">修改路線</a>
					</div>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					  設定
					</a>
					<div class="dropdown-menu" aria-labelledby="navbarDropdown">
					  <a class="dropdown-item" href="{{url_for('Personal_basic_information')}}">個人基本資料</a>
					  <a class="dropdown-item" href="{{url_for('change_password')}}">修改密碼</a>
					  <a class="dropdown-item" href="{{url_for('logout')}}">登出</a>
					</div>
				</li>
			</ul>
			<ul class="nav navbar-nav ml-auto">
				
			</ul>
			</div>
			
		</div>
	   </nav>
        
        <div class="container">
        
            <div class="intro-text my-4">  
                <h1>公車路線資訊</h1>
            </div>
			
			
            <div class="form-group row">
            
                <label for="input1" class="col-xs-3 col-md-auto col-form-label">
                    <h5>路線：</h5>
                </label>
                
                <div class="col-xs-4 col-md-3 col-lg-3">
                    <select id="inputState" class="form-control">
                        <option value="101">101 和平島</option>
                        <option value="102">102 祥豐街</option>
                        <option value="103">103 中正路</option>
                        <option value="104">104 海大</option>
                        <option value="105">105 新豐街</option>
                    </select>
                </div>
                
                <label for="input1" class="col-xs-3 col-md-auto col-form-label">
                    <h5>時間：</h5>
                </label>
                
                <div class="col-xs-4 col-md-3 col-lg-3">
                    <select id="inputState" class="form-control">
                        <option value="SUN">星期日 SUN</option>
                        <option value="MON">星期一 MON</option>
                        <option value="TUE">星期二 TUR</option>
                        <option value="WED">星期三 WED</option>
                        <option value="THU">星期四 THU</option>
                        <option value="FRI">星期五 FRI</option>
                        <option value="SAT">星期六 SAT</option>
                    </select>
                </div>
                
                <div class="col-auto mt-3 mt-md-0">
                    <button type="submit" class="btn btn-primary yes" onclock="disappear()">確認</button>
                </div>
            </div>
			
			
		    <div class="form-group row">
			  <div class="col-xs-12 col-md-8 col-lg-8" id="map" style="width:55%; height:450px; display: none">
				<script type="text/javascript">

					var map;

					

					var json = {
					 position1: {name: "深美國小", lat: 25.136333, lng: 121.778361},
					 position2: {name: "深溪路口", lat: 25.135139, lng: 121.782333},
					 position3: {name: "海中天社區", lat: 25.135306, lng: 121.784750},
					 position4: {name: "巴塞隆納社區", lat: 25.135611, lng: 121.785639},
					 position5: {name: "碧海擎天社區", lat: 25.136333, lng: 121.787778},
					 position6: {name: "普羅旺世社區", lat: 25.137444, lng: 121.788667},
					 position7: {name: "八斗高中", lat: 25.139583, lng: 121.789444},
					 position8: {name: "福泉寺", lat: 25.142389, lng: 121.789306},
					}
					
					console.log(JSON.stringify(json));
					
					// 載入路線服務與路線顯示圖層
					var directionsService = new google.maps.DirectionsService();
					var directionsDisplay = new google.maps.DirectionsRenderer({
						suppressMarkers: true // 單純畫路線，不要顯示 marker
					});
				
					// 初始化地圖
					map = new google.maps.Map(document.getElementById('map'), {
					zoom: 17,
					center: json.position2
					});
				
					// 放置路線圖層
					directionsDisplay.setMap(map);
					var waypts = [];
					var markers = [];
					
					var obj = Object.keys(json).map(function(_) { return json[_]; });
					console.log(obj);
					console.log(obj.length);
					 for (var i = 1; i < obj.length-1; i++) {
												waypts.push({
																location: obj[i],
																stopover: false
												});
								}
				
						var point = {
							origin: obj[0],
							destination: obj[obj.length-1],
							waypoints: waypts,
							optimizeWaypoints: true,
								travelMode: 'DRIVING'
						}
						directionsService.route( point, function(response, status) {
							if (status == 'OK') {
								// 回傳路線上每個步驟的細節
								for(var i = 0; i < obj.length; i++)
								{
									// 加入地圖標記
									markers[i] = new google.maps.Marker({
									position: obj[i],
									map: map,
									label: { text: ''+i, color: "#fff" },
									data: obj[i].name
									});
									// 加入資訊視窗
									var infowindow = new google.maps.InfoWindow();
									//infowindows[i].open(map, markers[i]);
				
									// 加入地圖標記點擊事件
									markers[i].addListener('click', function () {
											console.log("ouo");
											infowindow.setContent( this.data );
											infowindow.open(map, this);
									});
				
								}
							directionsDisplay.setDirections(response);
							} else {
							console.log(status);
							}
						});
						</script>
					</div>
					
					
					<div class="col-xs-12 col-md-4 col-lg-4" id = "bus" style = "display: none">
						<table class="table">
							<thead class="thead-dark">
							<tr>
								<th scope="col">班次</th>
								<th scope="col">發車時間</th>
								<th scope="col">司機</th>
							</tr>
							</thead>
							<!--<tbody>
							<tr>
								<th scope="row">1</th>
								<td>Mark</td>
								<td>Otto</td>
								<td>@mdo</td>
							</tr>
							<tr>
								<th scope="row">2</th>
								<td>Jacob</td>
								<td>Thornton</td>
								<td>@fat</td>
							</tr>
							<tr>
								<th scope="row">3</th>
								<td>Larry</td>
								<td>the Bird</td>
								<td>@twitter</td>
							</tr>
							</tbody>-->
						</table>
	
					
					
					
					</div>
				</div>

					
				</div>
				
				
					</div>
    </body>
</html>